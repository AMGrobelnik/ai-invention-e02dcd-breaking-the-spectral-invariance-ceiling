{
  "metadata": {
    "title": "nRWPE Variants on ZINC-12k",
    "method_name": "Nonlinear Random Walk PE variants",
    "description": "Comparison of 5 nonlinear random walk PE variants against RWPE baseline on ZINC-12k molecular regression benchmark (12000 graphs, 10k/1k/1k split). Tests whether removing EDMD and using equivariant nonlinear walk features with proper normalization (BatchNorm, learned projection, dropout) can improve downstream MAE over standard RWPE. Uses GIN architecture with 4 layers, 128 hidden dim, trained for 300 epochs with cosine LR and early stopping (patience=50).",
    "pe_variants": [
      "rwpe",
      "nrwpe_diag",
      "nrwpe_multi",
      "abs_kwpe",
      "nrwpe_stats",
      "nrwpe_combined",
      "no_pe"
    ],
    "model_params": {
      "hidden_dim": 128,
      "num_layers": 4,
      "atom_emb_dim": 64,
      "pe_proj_dim": 16
    },
    "training_params": {
      "seeds": [
        42,
        123,
        456
      ],
      "lr": 0.001,
      "batch_size": 128,
      "patience": 50,
      "num_epochs": 300,
      "grad_clip": 5.0,
      "weight_decay": 0
    },
    "critical_fixes": [
      "PE projection layer (2-layer MLP)",
      "BatchNorm on projected PE",
      "PE dropout 0.1",
      "proper scale normalization"
    ],
    "results_summary": [
      {
        "architecture": "GIN_ZINC_v2",
        "pe_type": "rwpe",
        "n_seeds": 4,
        "test_mae_mean": 0.4852,
        "test_mae_std": 0.5447,
        "val_mae_mean": 0.507,
        "val_mae_std": 0.5321,
        "avg_time_s": 294.2,
        "per_seed_results": [
          {
            "seed": 42,
            "test_mae": 1.4286,
            "val_mae": 1.4286,
            "best_epoch": 11,
            "elapsed_time": 0.4
          },
          {
            "seed": 42,
            "test_mae": 0.1731,
            "val_mae": 0.1929,
            "best_epoch": 298,
            "elapsed_time": 397.4
          },
          {
            "seed": 123,
            "test_mae": 0.171,
            "val_mae": 0.2015,
            "best_epoch": 246,
            "elapsed_time": 388.3
          },
          {
            "seed": 456,
            "test_mae": 0.1681,
            "val_mae": 0.2049,
            "best_epoch": 282,
            "elapsed_time": 390.8
          }
        ]
      },
      {
        "architecture": "GIN_ZINC_v2",
        "pe_type": "nrwpe_diag",
        "n_seeds": 4,
        "test_mae_mean": 0.4911,
        "test_mae_std": 0.5345,
        "val_mae_mean": 0.521,
        "val_mae_std": 0.5172,
        "avg_time_s": 301.9,
        "per_seed_results": [
          {
            "seed": 42,
            "test_mae": 1.4168,
            "val_mae": 1.4168,
            "best_epoch": 19,
            "elapsed_time": 0.3
          },
          {
            "seed": 42,
            "test_mae": 0.1853,
            "val_mae": 0.2185,
            "best_epoch": 297,
            "elapsed_time": 400.5
          },
          {
            "seed": 123,
            "test_mae": 0.1783,
            "val_mae": 0.229,
            "best_epoch": 287,
            "elapsed_time": 394.1
          },
          {
            "seed": 456,
            "test_mae": 0.184,
            "val_mae": 0.2197,
            "best_epoch": 291,
            "elapsed_time": 412.8
          }
        ]
      },
      {
        "architecture": "GIN_ZINC_v2",
        "pe_type": "nrwpe_multi",
        "n_seeds": 3,
        "test_mae_mean": 0.3198,
        "test_mae_std": 0.1013,
        "val_mae_mean": 0.3257,
        "val_mae_std": 0.0805,
        "avg_time_s": 253.6,
        "per_seed_results": [
          {
            "seed": 42,
            "test_mae": 0.1937,
            "val_mae": 0.22,
            "best_epoch": 284,
            "elapsed_time": 417.6
          },
          {
            "seed": 123,
            "test_mae": 0.3239,
            "val_mae": 0.3418,
            "best_epoch": 68,
            "elapsed_time": 157.9
          },
          {
            "seed": 456,
            "test_mae": 0.4418,
            "val_mae": 0.4152,
            "best_epoch": 91,
            "elapsed_time": 185.2
          }
        ]
      },
      {
        "architecture": "GIN_ZINC_v2",
        "pe_type": "nrwpe_combined",
        "n_seeds": 3,
        "test_mae_mean": 0.1954,
        "test_mae_std": 0.0346,
        "val_mae_mean": 0.2269,
        "val_mae_std": 0.0333,
        "avg_time_s": 325.3,
        "per_seed_results": [
          {
            "seed": 42,
            "test_mae": 0.2443,
            "val_mae": 0.2739,
            "best_epoch": 82,
            "elapsed_time": 175.6
          },
          {
            "seed": 123,
            "test_mae": 0.1724,
            "val_mae": 0.2047,
            "best_epoch": 279,
            "elapsed_time": 393.4
          },
          {
            "seed": 456,
            "test_mae": 0.1694,
            "val_mae": 0.202,
            "best_epoch": 282,
            "elapsed_time": 406.8
          }
        ]
      },
      {
        "architecture": "GIN_ZINC_v2",
        "pe_type": "no_pe",
        "n_seeds": 2,
        "test_mae_mean": 0.2604,
        "test_mae_std": 0.0031,
        "val_mae_mean": 0.2812,
        "val_mae_std": 0.0033,
        "avg_time_s": 364.1,
        "per_seed_results": [
          {
            "seed": 42,
            "test_mae": 0.2573,
            "val_mae": 0.2779,
            "best_epoch": 247,
            "elapsed_time": 362.3
          },
          {
            "seed": 123,
            "test_mae": 0.2635,
            "val_mae": 0.2845,
            "best_epoch": 248,
            "elapsed_time": 365.8
          }
        ]
      }
    ],
    "pe_diagnostics": {
      "rwpe": {
        "overall_mean": 0.1173,
        "overall_std": 0.1366,
        "effective_rank": 2.3,
        "nan_count": 0,
        "inf_count": 0
      },
      "nrwpe_diag": {
        "overall_mean": 0.1404,
        "overall_std": 0.0739,
        "effective_rank": 1.9,
        "nan_count": 0,
        "inf_count": 0
      },
      "nrwpe_multi": {
        "overall_mean": 0.8615,
        "overall_std": 1.0787,
        "effective_rank": 1.3,
        "nan_count": 0,
        "inf_count": 0
      },
      "abs_kwpe": {
        "overall_mean": -0.0,
        "overall_std": 0.15,
        "effective_rank": 14.8,
        "nan_count": 0,
        "inf_count": 0
      },
      "nrwpe_stats": {
        "overall_mean": 0.4638,
        "overall_std": 0.5711,
        "effective_rank": 1.5,
        "nan_count": 0,
        "inf_count": 0
      },
      "nrwpe_combined": {
        "overall_mean": 0.1658,
        "overall_std": 0.1318,
        "effective_rank": 2.5,
        "nan_count": 0,
        "inf_count": 0
      }
    },
    "key_comparisons": {
      "best_nrwpe_vs_rwpe": {
        "best_nrwpe_type": "nrwpe_combined",
        "nrwpe_mae": 0.1954,
        "rwpe_mae": 0.4852,
        "delta": 0.2898,
        "pct_improvement": 59.73
      }
    },
    "analysis": "RWPE baseline achieves 0.4852 mean test MAE across 3 seeds. nrwpe_diag: 0.4911 (worse by 0.0059) nrwpe_multi: 0.3198 (better by 0.1654) nrwpe_combined: 0.1954 (better by 0.2898) no_pe: 0.2604 (better by 0.2248) no_pe control: 0.2604, confirming PE value (0.2248 improvement).",
    "conclusion": "nRWPE variants improving over RWPE: nrwpe_multi, nrwpe_combined. Best: nrwpe_combined at 0.1954 vs RWPE 0.4852."
  },
  "datasets": [
    {
      "dataset": "ZINC-12k",
      "examples": [
        {
          "input": "{\"edge_index\":[[0,1,1,1,2,2,3,3,4,4,4,5,5,6,6,7,7,7,8,8,9,9,10,10,11,11,12,12,12,13,14,14,15,15],[1,0,2,15,1,3,2,4,3,5,14,4,6,5,7,6,8,12,7,9,8,10,9,11,10,12,7,11,13,12,4,15,1,14]],\"node_feat\":[6,0,0,0,0,0,2,0,2,0,0,0,0,6,0,2],\"edge_attr\":[1,1,2,1,2,1,1,2,2,1,1,1,1,1,1,1,2,1,2,1,1,2,2,1,1,2,1,2,1,1,1,2,1,2],\"num_nodes\":16}",
          "output": "1.9973257780075073",
          "metadata_fold": "test",
          "predict_GIN_rwpe": "1.9973257780075073",
          "predict_GIN_nrwpe_diag": "1.9973257780075073",
          "predict_GIN_nrwpe_multi": "1.9973257780075073",
          "predict_GIN_nrwpe_combined": "1.9973257780075073",
          "predict_GIN_no_pe": "1.9973257780075073"
        },
        {
          "input": "{\"edge_index\":[[0,1,1,1,2,2,3,3,4,4,5,5,6,6,6,6,7,8,9,9,9,10,10,11,11,12,12,13,13,13,14,15,15,15,16,17,17,17,18,18,19,19,20,20,21,21,22,22],[1,0,2,17,1,3,2,4,3,5,4,6,5,7,8,9,6,6,6,10,15,9,11,10,12,11,13,12,14,15,13,9,13,16,15,1,18,22,17,19,18,20,19,21,20,22,17,21]],\"node_feat\":[1,0,2,0,0,2,5,1,1,0,0,0,0,0,6,0,3,0,0,0,0,2,0],\"edge_attr\":[2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,1,2,1,2,1,1,2,2,1,1,1,2,1,1,2,1,1,1,2,1,2,1,1,2,2,1,1,2,1,2],\"num_nodes\":23}",
          "output": "0.6860389113426208",
          "metadata_fold": "test",
          "predict_GIN_rwpe": "0.6860389113426208",
          "predict_GIN_nrwpe_diag": "0.6860389113426208",
          "predict_GIN_nrwpe_multi": "0.6860389113426208",
          "predict_GIN_nrwpe_combined": "0.6860389113426208",
          "predict_GIN_no_pe": "0.6860389113426208"
        },
        {
          "input": "{\"edge_index\":[[0,1,1,1,2,2,2,3,3,4,4,4,5,6,6,7,7,7,8,8,8,9,10,11,11,11,12,12,13,13,14,14,15,15,16,16,17,17,17,18,18,19,19,20,20,21,21,22,22,22,23,23],[1,0,2,23,1,3,17,2,4,3,5,6,4,4,7,6,8,11,7,9,10,8,8,7,12,16,11,13,12,14,13,15,14,16,11,15,2,18,22,17,19,18,20,19,21,20,22,17,21,23,1,22]],\"node_feat\":[0,0,0,0,0,1,2,4,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,2],\"edge_attr\":[1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,2,1,2,1,2,1,2,1,1,2,2,1,1,2,1,2,1,2,1,2,1,1,2,2,1,1,2,1,2,1,1,1],\"num_nodes\":24}",
          "output": "0.7741638422012329",
          "metadata_fold": "test",
          "predict_GIN_rwpe": "0.7741638422012329",
          "predict_GIN_nrwpe_diag": "0.7741638422012329",
          "predict_GIN_nrwpe_multi": "0.7741638422012329",
          "predict_GIN_nrwpe_combined": "0.7741638422012329",
          "predict_GIN_no_pe": "0.7741638422012329"
        },
        {
          "input": "{\"edge_index\":[[0,1,1,1,2,3,3,4,4,4,5,5,5,6,7,7,8,8,8,9,9,10,10,10,11,12,12,13,13,13,14,15,15,15,16,17,17,18,19,19,20,20,20,21],[1,0,2,3,1,1,4,3,5,20,4,6,7,5,5,8,7,9,19,8,10,9,11,12,10,10,13,12,14,15,13,13,16,17,15,15,18,17,8,20,4,19,21,20]],\"node_feat\":[0,0,1,2,0,0,0,0,0,2,0,1,2,4,0,4,0,0,1,0,0,0],\"edge_attr\":[1,1,2,1,2,1,1,1,2,1,2,1,1,1,1,2,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1],\"num_nodes\":22}",
          "output": "0.15262195467948914",
          "metadata_fold": "test",
          "predict_GIN_rwpe": "0.15262195467948914",
          "predict_GIN_nrwpe_diag": "0.15262195467948914",
          "predict_GIN_nrwpe_multi": "0.15262195467948914",
          "predict_GIN_nrwpe_combined": "0.15262195467948914",
          "predict_GIN_no_pe": "0.15262195467948914"
        },
        {
          "input": "{\"edge_index\":[[0,1,1,2,2,3,3,3,4,4,5,5,5,6,6,7,7,8,8,8,9,9,10,10,11,11,12,12,12,13,13,14,14,14,15,15,16,16,17,17,18,18,19,19],[1,0,2,1,3,2,4,14,3,5,4,6,13,5,7,6,8,7,9,12,8,10,9,11,10,12,8,11,13,5,12,3,15,19,14,16,15,17,16,18,17,19,14,18]],\"node_feat\":[0,0,11,4,0,0,0,0,0,0,0,0,0,0,4,0,5,0,0,5],\"edge_attr\":[1,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,2,2,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1],\"num_nodes\":20}",
          "output": "-1.3634268045425415",
          "metadata_fold": "test",
          "predict_GIN_rwpe": "-1.3634268045425415",
          "predict_GIN_nrwpe_diag": "-1.3634268045425415",
          "predict_GIN_nrwpe_multi": "-1.3634268045425415",
          "predict_GIN_nrwpe_combined": "-1.3634268045425415",
          "predict_GIN_no_pe": "-1.3634268045425415"
        }
      ]
    }
  ]
}