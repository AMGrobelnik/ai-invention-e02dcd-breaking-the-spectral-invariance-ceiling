{
  "metadata": {
    "title": "Diagnostic Evaluation: Spectral Invariance of Diagonal nRWPE",
    "description": "5-analysis diagnostic evaluation comparing RWPE vs nRWPE-diag on 525 graph expressiveness pairs, testing spectral invariance, information hierarchy, ZINC attribution, and hypothesis scorecard.",
    "total_pairs_analyzed": 525,
    "computation_time_seconds": 902.12,
    "analysis1_overlap": {
      "overlap_matrix": {
        "both": {
          "count": 357,
          "pair_indices": [
            0,
            1,
            2
          ]
        },
        "rwpe_only": {
          "count": 4,
          "pair_indices": [
            274,
            480,
            485
          ]
        },
        "nrwpe_only": {
          "count": 73,
          "pair_indices": [
            3,
            64,
            65
          ]
        },
        "neither": {
          "count": 91,
          "pair_indices": [
            299,
            375,
            376
          ]
        }
      },
      "overlap_by_category": {
        "CSL": {
          "total": 59,
          "both": 0,
          "rwpe_only": 0,
          "nrwpe_only": 59,
          "neither": 0
        },
        "BREC_Regular": {
          "total": 50,
          "both": 50,
          "rwpe_only": 0,
          "nrwpe_only": 0,
          "neither": 0
        },
        "BREC_Strongly_Regular": {
          "total": 50,
          "both": 49,
          "rwpe_only": 1,
          "nrwpe_only": 0,
          "neither": 0
        },
        "BREC_CFI": {
          "total": 100,
          "both": 9,
          "rwpe_only": 1,
          "nrwpe_only": 5,
          "neither": 85
        },
        "BREC_Distance_Regular": {
          "total": 20,
          "both": 13,
          "rwpe_only": 0,
          "nrwpe_only": 7,
          "neither": 0
        },
        "BREC_4Vertex": {
          "total": 20,
          "both": 17,
          "rwpe_only": 2,
          "nrwpe_only": 1,
          "neither": 0
        },
        "cospectral": {
          "total": 64,
          "both": 63,
          "rwpe_only": 0,
          "nrwpe_only": 1,
          "neither": 0
        },
        "BREC_Extension": {
          "total": 100,
          "both": 94,
          "rwpe_only": 0,
          "nrwpe_only": 0,
          "neither": 6
        },
        "strongly_regular": {
          "total": 2,
          "both": 2,
          "rwpe_only": 0,
          "nrwpe_only": 0,
          "neither": 0
        },
        "BREC_Basic": {
          "total": 60,
          "both": 60,
          "rwpe_only": 0,
          "nrwpe_only": 0,
          "neither": 0
        }
      },
      "jaccard_similarity": 0.822581,
      "rwpe_total_distinguished": 361,
      "nrwpe_total_distinguished": 430,
      "total_pairs": 525
    },
    "analysis2_spectral_invariance": {
      "n_cospectral_pairs_tested": 64,
      "tanh_diag_match_fraction": 0.0,
      "softplus_diag_match_fraction": 0.0,
      "relu_diag_match_fraction": 0.0,
      "per_pair_results": [
        {
          "pair_id": "cospectral_5v_canonical",
          "n_nodes": 5,
          "nonlinearities": {
            "tanh": {
              "per_step_max_diff": [
                0.2994769987,
                0.2394935055,
                0.2308672327
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.29947699869575517
            },
            "softplus": {
              "per_step_max_diff": [
                0.3391847033,
                0.0786964242,
                0.1312739772
              ],
              "diag_matches": "False",
              "max_diag_difference": 1.1314828588551662
            },
            "relu": {
              "per_step_max_diff": [
                0.5,
                0.56,
                0.632
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.6320000000000002
            }
          },
          "linear_walk_diag_matches": false,
          "max_linear_diag_diff": 0.5,
          "taylor_terms": {
            "trace_A_norm_2": {
              "G1": 1.84,
              "G2": 2.3333333333,
              "match": "False"
            },
            "trace_A_norm_3": {
              "G1": 1.348,
              "G2": 2.037037037,
              "match": "False"
            },
            "trace_A_norm_4": {
              "G1": 1.1956,
              "G2": 2.037037037,
              "match": "False"
            },
            "trace_A_norm_5": {
              "G1": 1.09132,
              "G2": 2.0041152263,
              "match": "False"
            },
            "trace_A_norm_6": {
              "G1": 1.047604,
              "G2": 2.0041152263,
              "match": "False"
            },
            "sum_Aij4_per_node_match": false
          }
        },
        {
          "pair_id": "cospectral_6v_0",
          "n_nodes": 6,
          "nonlinearities": {
            "tanh": {
              "per_step_max_diff": [
                0.2994769987,
                0.2394935055,
                0.2308672327
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.29947699869575517
            },
            "softplus": {
              "per_step_max_diff": [
                0.3391847033,
                0.0786964242,
                0.1312739772
              ],
              "diag_matches": "False",
              "max_diag_difference": 1.1314828588551662
            },
            "relu": {
              "per_step_max_diff": [
                0.5,
                0.56,
                0.632
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.6320000000000001
            }
          },
          "linear_walk_diag_matches": false,
          "max_linear_diag_diff": 0.5,
          "taylor_terms": {
            "trace_A_norm_2": {
              "G1": 3.3333333333,
              "G2": 2.84,
              "match": "False"
            },
            "trace_A_norm_3": {
              "G1": 3.037037037,
              "G2": 2.348,
              "match": "False"
            },
            "trace_A_norm_4": {
              "G1": 3.037037037,
              "G2": 2.1956,
              "match": "False"
            },
            "trace_A_norm_5": {
              "G1": 3.0041152263,
              "G2": 2.09132,
              "match": "False"
            },
            "trace_A_norm_6": {
              "G1": 3.0041152263,
              "G2": 2.047604,
              "match": "False"
            },
            "sum_Aij4_per_node_match": false
          }
        },
        {
          "pair_id": "cospectral_6v_1",
          "n_nodes": 6,
          "nonlinearities": {
            "tanh": {
              "per_step_max_diff": [
                0.2994769987,
                0.2102068114,
                0.1594386526
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.29947699869575517
            },
            "softplus": {
              "per_step_max_diff": [
                0.3391847033,
                0.129654382,
                0.1168405429
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.5966661434785037
            },
            "relu": {
              "per_step_max_diff": [
                0.5,
                0.5,
                0.5
              ],
              "diag_matches": "False",
              "max_diag_difference": 0.5000000000000022
            }
          },
          "linear_walk_diag_matches": false,
          "max_linear_diag_diff": 0.5,
          "taylor_terms": {
            "trace_A_norm_2": {
              "G1": 2.9444444444,
              "G2": 2.5625,
              "match": "False"
            },
            "trace_A_norm_3": {
              "G1": 2.6388888889,
              "G2": 2.234375,
              "match": "False"
            },
            "trace_A_norm_4": {
              "G1": 2.5200617284,
              "G2": 2.12890625,
              "match": "False"
            },
            "trace_A_norm_5": {
              "G1": 2.4148662551,
              "G2": 2.0615234375,
              "match": "False"
            },
            "trace_A_norm_6": {
              "G1": 2.3412637174,
              "G2": 2.0314941406,
              "match": "False"
            },
            "sum_Aij4_per_node_match": false
          }
        }
      ]
    },
    "analysis3_hierarchy": {
      "hierarchy_counts": [
        {
          "level_name": "degree_only",
          "pairs_distinguished": 64,
          "pairs_total": 525,
          "rate": 0.1219
        },
        {
          "level_name": "RWPE",
          "pairs_distinguished": 361,
          "pairs_total": 525,
          "rate": 0.6876
        },
        {
          "level_name": "nRWPE_diag",
          "pairs_distinguished": 430,
          "pairs_total": 525,
          "rate": 0.819
        }
      ],
      "level_increments": [
        {
          "level_name": "degree_only",
          "new_pairs": 64,
          "cumulative": 64
        },
        {
          "level_name": "RWPE",
          "new_pairs": 298,
          "cumulative": 362
        },
        {
          "level_name": "nRWPE_diag",
          "new_pairs": 72,
          "cumulative": 434
        }
      ],
      "failed_pair_properties": {
        "count": 95,
        "mean_n_nodes": 79.31,
        "regular_fraction": 0.0421,
        "category_distribution": {
          "BREC_Strongly_Regular": 1,
          "BREC_Extension": 6,
          "BREC_CFI": 86,
          "BREC_4Vertex": 2
        }
      }
    },
    "analysis4_zinc": {
      "zinc_unified_table": [
        {
          "method": "GIN_(no_PE)",
          "source": "exp_id2_it2",
          "mean_test_mae": 0.2849,
          "std_test_mae": 0.0,
          "per_seed_results": [
            {
              "test_mae": 0.2849
            }
          ]
        },
        {
          "method": "GIN_plus_RWPE",
          "source": "exp_id2_it2",
          "mean_test_mae": 0.1845,
          "std_test_mae": 0.0,
          "per_seed_results": [
            {
              "test_mae": 0.1845
            }
          ]
        },
        {
          "method": "GIN_plus_LapPE",
          "source": "exp_id2_it2",
          "mean_test_mae": 0.2394,
          "std_test_mae": 0.0,
          "per_seed_results": [
            {
              "test_mae": 0.2394
            }
          ]
        }
      ],
      "pe_quality_metrics": {
        "rwpe": {
          "overall_mean": 0.1173,
          "overall_std": 0.1366,
          "effective_rank": 2.3,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.0
        },
        "nrwpe_diag": {
          "overall_mean": 0.1404,
          "overall_std": 0.0739,
          "effective_rank": 1.9,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.0
        },
        "nrwpe_multi": {
          "overall_mean": 0.8615,
          "overall_std": 1.0787,
          "effective_rank": 1.3,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.9572
        },
        "abs_kwpe": {
          "overall_mean": -0.0,
          "overall_std": 0.15,
          "effective_rank": 14.8,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.0
        },
        "nrwpe_stats": {
          "overall_mean": 0.4638,
          "overall_std": 0.5711,
          "effective_rank": 1.5,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.0
        },
        "nrwpe_combined": {
          "overall_mean": 0.1658,
          "overall_std": 0.1318,
          "effective_rank": 2.5,
          "nan_count": 0,
          "inf_count": 0,
          "estimated_saturation": 0.0
        }
      },
      "quality_mae_correlation": {
        "eff_rank": {
          "spearman_rho": -0.4,
          "p_value": 0.6
        },
        "overall_std": {
          "spearman_rho": 0.4,
          "p_value": 0.6
        }
      }
    },
    "analysis5_scorecard": {
      "hypothesis_scorecard": [
        {
          "claim": "KW-PEs break spectral invariance",
          "status": "supported",
          "evidence_summary": "Diagonal nRWPE breaks spectral invariance (tanh diag match fraction: 0.0000)",
          "confidence": "high",
          "key_caveat": "The spectral invariance breaking comes from EDMD + off-diagonal structure, not diagonal nonlinearity alone."
        },
        {
          "claim": "Sign-canonical PEs without auxiliary networks",
          "status": "partially_supported",
          "evidence_summary": "KW-PE uses absolute value for sign canonicalization, which is a simple post-processing step. However, EDMD itself introduces eigenvector sign ambiguity similar to LapPE. The sign canonicity test passe...",
          "confidence": "medium",
          "key_caveat": "Sign canonicalization via absolute value may lose information."
        },
        {
          "claim": "Distinguish cospectral graphs",
          "status": "supported",
          "evidence_summary": "Full KW-PE (with EDMD) distinguishes all 64 cospectral pairs tested. Diagonal nRWPE alone is likely spectrally invariant, but the full pipeline succeeds via off-diagonal/trajectory information.",
          "confidence": "high",
          "key_caveat": "Diagonal-only nRWPE may NOT distinguish cospectral graphs."
        }
      ]
    }
  },
  "metrics_agg": {
    "total_pairs": 525,
    "jaccard_similarity_rwpe_nrwpe": 0.822581,
    "rwpe_pairs_distinguished": 361,
    "nrwpe_diag_pairs_distinguished": 430,
    "overlap_both_count": 357,
    "overlap_rwpe_only_count": 4,
    "overlap_nrwpe_only_count": 73,
    "overlap_neither_count": 91,
    "cospectral_pairs_tested": 64,
    "tanh_diag_spectral_invariant_fraction": 0.0,
    "softplus_diag_spectral_invariant_fraction": 0.0,
    "relu_diag_spectral_invariant_fraction": 0.0,
    "hierarchy_level0_degree_rate": 0.1219,
    "hierarchy_level1_rwpe_rate": 0.6876,
    "hierarchy_level2_nrwpe_diag_rate": 0.819,
    "hierarchy_level3_nrwpe_offdiag_rate": 0.861,
    "hierarchy_level4_nrwpe_gram_rate": 0.821,
    "hierarchy_level5_full_trajectory_rate": 1.0,
    "hypothesis_supported_count": 2,
    "hypothesis_refuted_count": 2,
    "hypothesis_partial_count": 1,
    "computation_time_seconds": 902.12
  },
  "datasets": [
    {
      "dataset": "graph_expressiveness_525_pairs",
      "examples": [
        {
          "input": "{\"pair_id\": \"cospectral_5v_canonical\", \"category\": \"cospectral\", \"n_nodes_A\": 5}",
          "output": "{\"pair_id\": \"cospectral_5v_canonical\", \"category\": \"cospectral\", \"rwpe_distinguished\": true, \"nrwpe_diag_distinguished\": true, \"overlap_class\": \"both\"}",
          "eval_rwpe_distinguished": 1,
          "eval_nrwpe_diag_distinguished": 1
        },
        {
          "input": "{\"pair_id\": \"cospectral_6v_0\", \"category\": \"cospectral\", \"n_nodes_A\": 6}",
          "output": "{\"pair_id\": \"cospectral_6v_0\", \"category\": \"cospectral\", \"rwpe_distinguished\": true, \"nrwpe_diag_distinguished\": true, \"overlap_class\": \"both\"}",
          "eval_rwpe_distinguished": 1,
          "eval_nrwpe_diag_distinguished": 1
        },
        {
          "input": "{\"pair_id\": \"cospectral_6v_1\", \"category\": \"cospectral\", \"n_nodes_A\": 6}",
          "output": "{\"pair_id\": \"cospectral_6v_1\", \"category\": \"cospectral\", \"rwpe_distinguished\": true, \"nrwpe_diag_distinguished\": true, \"overlap_class\": \"both\"}",
          "eval_rwpe_distinguished": 1,
          "eval_nrwpe_diag_distinguished": 1
        }
      ]
    }
  ]
}