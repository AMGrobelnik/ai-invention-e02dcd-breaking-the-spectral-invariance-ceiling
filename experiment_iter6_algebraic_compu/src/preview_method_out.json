{
  "metadata": {
    "experiment_title": "nRWPE-diag vs RWPE-diag: Expressiveness within the Spectral Invariant Hierarchy",
    "critical_theoretical_correction": {
      "original_claim": "nRWPE breaks the spectral invariance ceiling (EPNN < 3-WL)",
      "corrected_claim": "nRWPE IS spectrally invariant (it is a function of A = Σ λ_i P_i). It cannot break the EPNN ceiling. However, nRWPE captures MORE spectral invariants than RWPE within the spectral invariant hierarchy.",
      "proof_sketch": "nRWPE-diag computes x_{t+1} = σ(Ã·x_t) where Ã is uniquely determined by the spectral decomposition {(λ_i, P_i)}. Since A = Σ λ_i P_i, any deterministic function of A is spectrally invariant. Therefor...",
      "hierarchy_placement": "RWPE-diag ≤ nRWPE-diag ≤ EPNN ≤ PSWL < 3-WL"
    },
    "computational_survey_summary": {
      "total_pairs": 525,
      "rwpe_distinguishes_count": 342,
      "by_nonlinearity": {
        "tanh": 349,
        "softplus": 341,
        "relu": 344,
        "cubic": 348
      },
      "offdiag_nrwpe_distinguishes_count": 525,
      "category_breakdown": {
        "cospectral": {
          "total": 64,
          "rwpe_dist": 64,
          "nrwpe_tanh_dist": 64,
          "offdiag_dist": 64,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [],
          "both": [
            "cospectral_5v_canonical",
            "cospectral_6v_0",
            "cospectral_6v_1"
          ]
        },
        "CSL": {
          "total": 59,
          "rwpe_dist": 59,
          "nrwpe_tanh_dist": 59,
          "offdiag_dist": 59,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [],
          "both": [
            "csl_41_2_3",
            "csl_41_2_4",
            "csl_41_2_5"
          ]
        },
        "strongly_regular": {
          "total": 2,
          "rwpe_dist": 0,
          "nrwpe_tanh_dist": 0,
          "offdiag_dist": 2,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [
            "srg_shrikhande_vs_rook",
            "srg_T8_vs_chang0"
          ],
          "both": []
        },
        "BREC_Basic": {
          "total": 60,
          "rwpe_dist": 60,
          "nrwpe_tanh_dist": 60,
          "offdiag_dist": 60,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [],
          "both": [
            "brec_basic_0",
            "brec_basic_1",
            "brec_basic_2"
          ]
        },
        "BREC_Regular": {
          "total": 50,
          "rwpe_dist": 50,
          "nrwpe_tanh_dist": 50,
          "offdiag_dist": 50,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [],
          "both": [
            "brec_regular_0",
            "brec_regular_1",
            "brec_regular_2"
          ]
        },
        "BREC_Strongly_Regular": {
          "total": 50,
          "rwpe_dist": 0,
          "nrwpe_tanh_dist": 0,
          "offdiag_dist": 50,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [
            "brec_str_0",
            "brec_str_1",
            "brec_str_2"
          ],
          "both": []
        },
        "BREC_Extension": {
          "total": 100,
          "rwpe_dist": 100,
          "nrwpe_tanh_dist": 100,
          "offdiag_dist": 100,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [],
          "both": [
            "brec_extension_0",
            "brec_extension_1",
            "brec_extension_2"
          ]
        },
        "BREC_CFI": {
          "total": 100,
          "rwpe_dist": 9,
          "nrwpe_tanh_dist": 16,
          "offdiag_dist": 100,
          "nrwpe_only": [
            "brec_cfi_11",
            "brec_cfi_12",
            "brec_cfi_13"
          ],
          "rwpe_only": [],
          "neither": [
            "brec_cfi_0",
            "brec_cfi_1",
            "brec_cfi_2"
          ],
          "both": [
            "brec_cfi_5",
            "brec_cfi_18",
            "brec_cfi_19"
          ]
        },
        "BREC_4Vertex": {
          "total": 20,
          "rwpe_dist": 0,
          "nrwpe_tanh_dist": 0,
          "offdiag_dist": 20,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [
            "brec_4vtx_0",
            "brec_4vtx_1",
            "brec_4vtx_2"
          ],
          "both": []
        },
        "BREC_Distance_Regular": {
          "total": 20,
          "rwpe_dist": 0,
          "nrwpe_tanh_dist": 0,
          "offdiag_dist": 20,
          "nrwpe_only": [],
          "rwpe_only": [],
          "neither": [
            "brec_dr_0",
            "brec_dr_1",
            "brec_dr_2"
          ],
          "both": []
        }
      },
      "nrwpe_only_pairs": [
        "brec_cfi_11",
        "brec_cfi_12",
        "brec_cfi_13"
      ],
      "rwpe_only_pairs": [],
      "both_pairs_count": 342,
      "neither_pairs_count": 174,
      "entrywise_power_sum_distinguishing": {
        "S_2": 64,
        "S_4": 64,
        "S_6": 64
      }
    },
    "symbolic_derivation_k14_c4k1": {
      "eigenvalues_K14": {
        "-2": 1,
        "2": 1,
        "0": 3
      },
      "eigenvalues_C4K1": {
        "-2": 1,
        "2": 1,
        "0": 3
      },
      "cospectral_verified": true,
      "Atilde_K14": "[[0, 1/2, 1/2, 1/2, 1/2], [1/2, 0, 0, 0, 0], [1/2, 0, 0, 0, 0], [1/2, 0, 0, 0, 0], [1/2, 0, 0, 0, 0]]",
      "Atilde_C4K1": "[[0, 1/2, 0, 1/2, 0], [1/2, 0, 1/2, 0, 0], [0, 1/2, 0, 1/2, 0], [1/2, 0, 1/2, 0, 0], [0, 0, 0, 0, 0]]",
      "rwpe_diag_comparison": {
        "k=1": {
          "K14_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "C4K1_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "multisets_match": true
        },
        "k=2": {
          "K14_sorted_diag": [
            "1/4",
            "1/4",
            "1/4"
          ],
          "C4K1_sorted_diag": [
            "0",
            "1/2",
            "1/2"
          ],
          "multisets_match": false
        },
        "k=3": {
          "K14_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "C4K1_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "multisets_match": true
        },
        "k=4": {
          "K14_sorted_diag": [
            "1/4",
            "1/4",
            "1/4"
          ],
          "C4K1_sorted_diag": [
            "0",
            "1/2",
            "1/2"
          ],
          "multisets_match": false
        },
        "k=5": {
          "K14_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "C4K1_sorted_diag": [
            "0",
            "0",
            "0"
          ],
          "multisets_match": true
        }
      },
      "tanh_taylor_order5": "2*t**5/15 - t**3/3 + t",
      "nrwpe_K14": {
        "node_0": {
          "step1_return": "0",
          "step2_return": "192377319/256000000"
        },
        "node_1": {
          "step1_return": "0",
          "step2_return": "59563317319/262144000000"
        },
        "node_2": {
          "step1_return": "0",
          "step2_return": "59563317319/262144000000"
        },
        "node_3": {
          "step1_return": "0",
          "step2_return": "59563317319/262144000000"
        },
        "node_4": {
          "step1_return": "0",
          "step2_return": "59563317319/262144000000"
        }
      },
      "nrwpe_C4K1": {
        "node_0": {
          "step1_return": "0",
          "step2_return": "3541765319/8192000000"
        },
        "node_1": {
          "step1_return": "0",
          "step2_return": "3541765319/8192000000"
        },
        "node_2": {
          "step1_return": "0",
          "step2_return": "3541765319/8192000000"
        },
        "node_3": {
          "step1_return": "0",
          "step2_return": "3541765319/8192000000"
        },
        "node_4": {
          "step1_return": "0",
          "step2_return": "0"
        }
      },
      "entrywise_power_sums": {
        "S2_K14": [
          "1/4",
          "1/4",
          "1/4"
        ],
        "S4_K14": [
          "1/16",
          "1/16",
          "1/16"
        ],
        "S2_C4K1": [
          "0",
          "1/2",
          "1/2"
        ],
        "S4_C4K1": [
          "0",
          "1/8",
          "1/8"
        ],
        "S2_multisets_match": false,
        "S4_multisets_match": false
      },
      "cross_term_analysis": {
        "description": "S_4(i) = sum_j Atilde_{ij}^4 vs [Atilde^4]_{ii} = sum_j (Atilde^2)_{ij}^2",
        "S4_K14": [
          "1/4",
          "1/16",
          "1/16"
        ],
        "A4_diag_K14": [
          "1",
          "1/4",
          "1/4"
        ],
        "S4_equals_A4_diag": false,
        "conclusion": "S_4(i) != [A^4]_{ii} in general - nRWPE captures distinct information"
      }
    },
    "taylor_expansion_analysis": {
      "nrwpe_step2_expansion": "For sigma(x) = x - x^3/3 + 2x^5/15 - ... (tanh Taylor):\nx_1[j] = sigma(Atilde_{ji}) = Atilde_{ij} - Atilde_{ij}^3/3 + 2*Atilde_{ij}^5/15 - ...\n(using Atilde symmetric: Atilde_{ji} = Atilde_{ij})\n\ninne...",
      "key_comparison": {
        "RWPE_diag_captures": "[Atilde^k]_{ii} for k=1..K, i.e. matrix-power diagonals",
        "nRWPE_diag_captures": "S_2(i), S_4(i), S_6(i), S_2(i)^3, S_2(i)^2*S_4(i), ... (entrywise power sums and products)",
        "crucial_distinction": "[Atilde^4]_{ii} = sum_j (sum_m Atilde_{im}*Atilde_{mj})^2 involves 2-hop path products.\nS_4(i) = sum_j Atilde_{ij}^4 involves 4th power of DIRECT edge weights.\nThese are DIFFERENT quantities! S_4 is N..."
      },
      "theorem": "For any analytic nonlinearity sigma with sigma'''(0) != 0, the nRWPE-diag x_2[i] depends on S_4(i) = sum_j Atilde_{ij}^4 which is not a function of {[Atilde^k]_{ii} : k in N}. Therefore nRWPE-diag is ...",
      "hierarchy_placement": "RWPE-diag <= nRWPE-diag <= EPNN <= PSWL < 3-WL"
    },
    "nrwpe_only_pair_analysis": {
      "best_pair": "brec_cfi_12",
      "num_nodes": 38,
      "category": "BREC_CFI",
      "nrwpe_details": {
        "tanh": {
          "distinguishes": true,
          "max_difference": 1.8885855735187307e-09
        },
        "softplus": {
          "distinguishes": false,
          "max_difference": 1.531841320456806e-11
        },
        "relu": {
          "distinguishes": false,
          "max_difference": 5.551115123125783e-17
        },
        "cubic": {
          "distinguishes": true,
          "max_difference": 1.3622840884866538e-09
        }
      },
      "rwpe_max_diff": 8.673617379884035e-19,
      "entrywise_power_sums": {
        "S_2": {
          "distinguishes": false,
          "max_difference": 0.0
        },
        "S_4": {
          "distinguishes": false,
          "max_difference": 0.0
        },
        "S_6": {
          "distinguishes": false,
          "max_difference": 0.0
        }
      }
    },
    "srg_analysis": {
      "rook_degree": 6,
      "shrikhande_degree": 6,
      "both_6_regular": "True",
      "eigenvalues_rook": [
        -2.0,
        -2.0,
        -2.0
      ],
      "eigenvalues_shrikhande": [
        -2.0,
        -2.0,
        -2.0
      ],
      "cospectral": true,
      "rwpe_distinguishes": false,
      "rwpe_max_diff": 1.3877787807814457e-17,
      "nrwpe_diag": {
        "tanh": {
          "distinguishes": false,
          "max_difference": 2.7755575615628914e-17
        },
        "softplus": {
          "distinguishes": false,
          "max_difference": 4.440892098500626e-16
        },
        "relu": {
          "distinguishes": false,
          "max_difference": 1.3877787807814457e-17
        },
        "cubic": {
          "distinguishes": false,
          "max_difference": 4.163336342344337e-17
        }
      },
      "offdiag_nrwpe_tanh_distinguishes": true,
      "offdiag_nrwpe_max_diff": 0.1651404129246294,
      "pair_level_nrwpe_distinguishes": true,
      "pair_level_nrwpe_max_diff": 0.1651404129246294,
      "equitable_partition_analysis": {
        "quotient_matrix": "Q = [[0,6,0],[1,2,3],[0,2,4]]",
        "lambda_equals_mu": true,
        "explanation": "For srg(16,6,2,2), starting from any node i, the partition {i}, N(i), V\\(N(i)∪{i}) is equitable with quotient Q. Since lambda=mu=2, rows 2 and 3 have the SAME number of neighbors in each class. Both g..."
      },
      "edmd_distinguishes": false,
      "edmd_max_diff": 3.766947864747294e-11
    },
    "edmd_analysis_summary": {
      "total_analyzed": 288,
      "edmd_distinguishes_count": 286,
      "edmd_only_pairs": [
        "cospectral_5v_canonical",
        "cospectral_6v_0",
        "cospectral_6v_2"
      ]
    },
    "conclusions": [
      "1. nRWPE IS spectrally invariant, correcting the original hypothesis claim",
      "2. nRWPE captures entrywise-power invariants S_{2p}(i) beyond RWPE's matrix-power diagonals",
      "3. nRWPE-only pairs found: 9 (pairs where nRWPE distinguishes but RWPE does not)"
    ],
    "computation_time_seconds": 133.47389340400696,
    "k_steps": 20,
    "threshold": 1e-10,
    "nonlinearities": [
      "tanh",
      "softplus",
      "relu"
    ]
  },
  "datasets": [
    {
      "dataset": "graph_expressiveness_benchmark",
      "examples": [
        {
          "input": "{\"graph_A\": {\"num_nodes\": 5, \"num_edges\": 4, \"adjacency_matrix\": [[0, 1, 1, 1, 1], [1, 0, 0, 0, 0], [1, 0, 0, 0, 0], [1, 0, 0, 0, 0], [1, 0, 0, 0, 0]], \"edge_list\": [[0, 1], [0, 2], [0, 3], [0, 4]], \"...",
          "output": "{\"is_isomorphic\": false, \"are_cospectral\": true}",
          "predict_rwpe_diag": "distinguished",
          "predict_nrwpe_diag_any": "distinguished",
          "predict_offdiag_nrwpe": "distinguished",
          "predict_edmd": "distinguished",
          "metadata_pair_id": "cospectral_5v_canonical",
          "metadata_category": "cospectral",
          "metadata_subcategory": "5_vertex_canonical",
          "metadata_num_nodes_A": 5,
          "metadata_num_nodes_B": 5,
          "metadata_row_index": 0,
          "predict_nrwpe_tanh": "distinguished",
          "metadata_nrwpe_tanh_max_diff": 0.29608622384819666,
          "predict_nrwpe_softplus": "distinguished",
          "metadata_nrwpe_softplus_max_diff": 1.9697538720396213,
          "predict_nrwpe_relu": "distinguished",
          "metadata_nrwpe_relu_max_diff": 0.5000000000000022,
          "predict_nrwpe_cubic": "distinguished",
          "metadata_nrwpe_cubic_max_diff": 176.02553122110422,
          "metadata_rwpe_max_diff": 0.5000000000000022,
          "metadata_offdiag_max_diff": 0.7278944044432927
        },
        {
          "input": "{\"graph_A\": {\"num_nodes\": 6, \"num_edges\": 4, \"adjacency_matrix\": [[0, 0, 0, 1, 1, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 1], [0, 0, 0, 1, 1, 0]], \"edge_list\": ...",
          "output": "{\"is_isomorphic\": false, \"are_cospectral\": true}",
          "predict_rwpe_diag": "distinguished",
          "predict_nrwpe_diag_any": "distinguished",
          "predict_offdiag_nrwpe": "distinguished",
          "predict_edmd": "distinguished",
          "metadata_pair_id": "cospectral_6v_0",
          "metadata_category": "cospectral",
          "metadata_subcategory": "6_vertex_atlas",
          "metadata_num_nodes_A": 6,
          "metadata_num_nodes_B": 6,
          "metadata_row_index": 1,
          "predict_nrwpe_tanh": "distinguished",
          "metadata_nrwpe_tanh_max_diff": 0.29608622384819666,
          "predict_nrwpe_softplus": "distinguished",
          "metadata_nrwpe_softplus_max_diff": 1.9697538720396213,
          "predict_nrwpe_relu": "distinguished",
          "metadata_nrwpe_relu_max_diff": 0.5000000000000022,
          "predict_nrwpe_cubic": "distinguished",
          "metadata_nrwpe_cubic_max_diff": 176.02553122110422,
          "metadata_rwpe_max_diff": 0.5000000000000022,
          "metadata_offdiag_max_diff": 0.46211715726000974
        },
        {
          "input": "{\"graph_A\": {\"num_nodes\": 6, \"num_edges\": 4, \"adjacency_matrix\": [[0, 0, 1, 0, 0, 0], [0, 0, 1, 1, 0, 0], [1, 1, 0, 0, 0, 0], [0, 1, 0, 0, 0, 1], [0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0]], \"edge_list\": ...",
          "output": "{\"is_isomorphic\": false, \"are_cospectral\": true}",
          "predict_rwpe_diag": "distinguished",
          "predict_nrwpe_diag_any": "distinguished",
          "predict_offdiag_nrwpe": "distinguished",
          "predict_edmd": "distinguished",
          "metadata_pair_id": "cospectral_6v_1",
          "metadata_category": "cospectral",
          "metadata_subcategory": "6_vertex_atlas",
          "metadata_num_nodes_A": 6,
          "metadata_num_nodes_B": 6,
          "metadata_row_index": 2,
          "predict_nrwpe_tanh": "distinguished",
          "metadata_nrwpe_tanh_max_diff": 0.29190512497730875,
          "predict_nrwpe_softplus": "distinguished",
          "metadata_nrwpe_softplus_max_diff": 1.882115611291824,
          "predict_nrwpe_relu": "distinguished",
          "metadata_nrwpe_relu_max_diff": 0.5000000000000016,
          "predict_nrwpe_cubic": "distinguished",
          "metadata_nrwpe_cubic_max_diff": 176.66666666666666,
          "metadata_rwpe_max_diff": 0.5000000000000016,
          "metadata_offdiag_max_diff": 0.7615941559557649
        }
      ]
    }
  ]
}